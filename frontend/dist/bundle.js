!function(t){function e(i){if(n[i])return n[i].exports;var s=n[i]={exports:{},id:i,loaded:!1};return t[i].call(s.exports,s,s.exports,e),s.loaded=!0,s.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){n(1)},function(t,e,n){"use strict";var i,s=n(2),o=n(6),r=new o,a=n(18),h=r.getWidths().then(function(t){var e=document.querySelector("#shelves1");return e.setAttribute("data-segment-widths",JSON.stringify(t)),Promise.resolve()});h.then(function(){function t(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}}function e(){i.unbind(),i=new s("#shelves1"),i.start()}i=new s("#shelves1"),i.start(),a();var n=200,o=56,r=t();window.addEventListener("resize",_.debounce(function(n){var i=t(),s=r.width!==i.width,a=Math.abs(r.height-i.height)>o;(s||a)&&(e(),r=i)},n))})},function(t,e,n){"use strict";var i=n(3),s=n(4),o=n(12),r=n(13),a=n(14),h=n(15),c=function(){function t(t){var e=this;this.isDeleted=!1,this.events=new i,this.xMove=0,this.yMove=0,this.drawingController=new a,this.valueAnimatorController=new h,this.frameRequestCallback=function(t){e.onAnimationFrame(t)},this.container=document.querySelector(t),this.canvas=this.container.querySelector("canvas"),this.fitCanvas(),this.canvasWidth=this.canvas.width,this.canvasHeight=this.canvas.height,this.y=this.container.getBoundingClientRect().top,this.fitPlaceHolder(t),this.container.classList.remove("loading"),this.ctx=this.canvas.getContext("2d"),this.segmentWidths=JSON.parse(this.container.getAttribute("data-segment-widths")),this.segmentHeight=parseInt(this.container.getAttribute("data-segment-height"),10),this.setInitialScale(),this.segmentController=new s(this,this.segmentWidths),this.bindControl(),this.hammerManager=r(this)}return t.prototype.getCanvas=function(){return this.canvas},t.prototype.getCanvasContext=function(){return this.ctx},t.prototype.getCanvasWidth=function(){return this.canvasWidth},t.prototype.getCanvasHeight=function(){return this.canvasHeight},t.prototype.getXMove=function(){return this.xMove},t.prototype.setXMove=function(t){this.xMove=t},t.prototype.getYMove=function(){return this.yMove},t.prototype.setYMove=function(t){this.yMove=t},t.prototype.getInitialScale=function(){return this.initialScale},t.prototype.getZoomScale=function(){return this.zoomScale},t.prototype.getScale=function(){return this.scale},t.prototype.getY=function(){return this.y},t.prototype.start=function(){window.requestAnimationFrame(this.frameRequestCallback)},t.prototype.onClick=function(t){this.segmentController.onClick(t)},t.prototype.animate=function(t,e){var n=this;this.valueAnimatorController.add({id:t,start:this[t],end:e,timestamp:this.timestamp,onChange:function(e){n[t]=e}})},t.prototype.beginAnimation=function(){this.drawingController.beginAnimation()},t.prototype.endAnimation=function(){this.drawingController.endAnimation()},t.prototype.unbind=function(){this.isDeleted=!0,this.events.removeAllEventListeners(),this.hammerManager.destroy()},t.prototype.fitCanvas=function(){this.canvas.width=document.documentElement.clientWidth;var t=document.documentElement.clientHeight,e=this.container.getBoundingClientRect().top,n=.05*t;this.canvas.height=t-e-n},t.prototype.fitPlaceHolder=function(t){var e=document.querySelector('.shelvesPlaceHolder[data-place-holder-for="'+t+'"]');e.style.height=this.container.getBoundingClientRect().height+"px"},t.prototype.setInitialScale=function(){this.initialScale=this.canvasHeight/this.segmentHeight;var t=_.max(this.segmentWidths);this.zoomScale=Math.min(this.canvasWidth/(1.25*t),1),this.scale=this.initialScale},t.prototype.bindControl=function(){var t=this,e=this.container.querySelector(".leftSlideBtn");this.events.addEventListener(e,"click",function(e){e.preventDefault(),t.slideLeft()});var n=this.container.querySelector(".rightSlideBtn");this.events.addEventListener(n,"click",function(e){e.preventDefault(),t.slideRight()});var i=this.container.querySelector(".zoomInBtn");this.events.addEventListener(i,"click",function(e){e.preventDefault(),t.scale+=.01});var s=this.container.querySelector(".zoomOutBtn");this.events.addEventListener(s,"click",function(e){e.preventDefault(),t.scale-=.01})},t.prototype.slideRight=function(){var t=this.xMove-this.canvasWidth;this.animate("xMove",t)},t.prototype.slideLeft=function(){var t=this.xMove+this.canvasWidth;this.animate("xMove",t)},t.prototype.onAnimationFrame=function(t){this.timestamp=t,this.valueAnimatorController.onAnimationFrame(t),this.mustBeRedraw()&&(this.blockVerticalMoveOutsideCanvas(),this.draw()),o.instance.tick(t),this.isDeleted||window.requestAnimationFrame(this.frameRequestCallback)},t.prototype.draw=function(){this.drawnXMove=this.xMove,this.drawnYMove=this.yMove,this.drawnScale=this.scale,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.save(),this.ctx.translate(this.xMove,this.yMove),this.ctx.scale(this.scale,this.scale),this.segmentController.draw(),this.ctx.restore()},t.prototype.mustBeRedraw=function(){return this.xMove!==this.drawnXMove||this.yMove!==this.drawnYMove||this.scale!==this.drawnScale||this.segmentController.checkIfNonDrawnSegmentsExistsAndReset()},t.prototype.blockVerticalMoveOutsideCanvas=function(){this.yMove=Math.min(0,this.yMove),this.yMove=Math.max(this.yMove,this.canvasHeight-this.canvasHeight*(this.scale/this.initialScale))},t}();t.exports=c},function(t,e){var n=function(){function t(){this.eventArgsList=new Array}return t.prototype.addEventListener=function(t,e,n){this.eventArgsList.push({element:t,type:e,listener:n}),t.addEventListener(e,n,!1)},t.prototype.removeAllEventListeners=function(){for(var t=0,e=this.eventArgsList;t<e.length;t++){var n=e[t],i=n.element,s=n.type,o=n.listener;i.removeEventListener(s,o,!1)}},t}();t.exports=n},function(t,e,n){"use strict";var i=n(5),s=n(9),o=n(11),r=function(){function t(t,e){var n=this;this.viewPort=t,this.segmentWidths=e,this.segments=new Array,this.notDrawnSegmentCount=0;var r={INITIAL_SCALE:t.getInitialScale(),CANVAS_WIDTH:t.getCanvasWidth(),SEGMENT_WIDTHS:e,START_SEGMENT_INDEX:0,START_X:0,segments:this.segments,createSegment:function(e,s){var o=new i(t,e,s);return o.load().then(function(){n.notDrawnSegmentCount++}),o}};this.prepender=new s(r),this.appender=new o(r)}return t.prototype.onClick=function(t){var e=this.viewPort.getScale();t.x=(t.x-this.viewPort.getXMove())/e,t.y=(t.y-this.viewPort.getYMove()-this.viewPort.getY())/e;for(var n,i=0,s=this.segments;i<s.length;i++){var o=s[i];if(o.isClicked(t)){n=o;break}}n?n.fitOnViewPort(t.y):console.error("cannot find clicked segment")},t.prototype.checkIfNonDrawnSegmentsExistsAndReset=function(){var t=this.notDrawnSegmentCount>0;return this.notDrawnSegmentCount=0,t},t.prototype.draw=function(){for(var t=0,e=this.segments;t<e.length;t++){var n=e[t];n.draw()}this.preloadSegments()},t.prototype.preloadSegments=function(){var t=this.viewPort.getXMove(),e=this.viewPort.getScale(),n=this.viewPort.getInitialScale();t*=n/e,this.appender.work(t),this.prepender.work(t)},t}();t.exports=r},function(t,e,n){"use strict";var i=n(6),s=n(8),o=new i,r=function(){function t(t,e,n){this.viewPort=t,this.index=e,this.x=n,this.isLoaded=!1,this.ctx=t.getCanvasContext()}return t.prototype.getIndex=function(){return this.index},t.prototype.getX=function(){return this.x},t.prototype.load=function(){var t=this;return o.getByPosition(this.index).then(function(e){return t.width=e.width,t.height=e.height,t.productPositions=e.productPositions,s(e.spriteImgUrl)}).then(function(e){return t.spriteImg=e,t.canvas=t.createCanvas(),t.isLoaded=!0,Promise.resolve()})},t.prototype.draw=function(){this.isLoaded&&this.ctx.drawImage(this.canvas,0,0,this.width,this.height,this.x,0,this.width,this.height)},t.prototype.isClicked=function(t){return t.x>this.x&&t.x<this.x+this.width},t.prototype.fitOnViewPort=function(t){var e=this.viewPort.getZoomScale(),n=this.viewPort.getCanvasWidth(),i=(n-this.width*e)/2-this.x*e,s=this.viewPort.getCanvasHeight(),o=s/2-t*e;this.viewPort.animate("xMove",i),this.viewPort.animate("yMove",o),this.viewPort.animate("scale",e)},t.prototype.createCanvas=function(){var t=document.createElement("canvas");t.width=this.width,t.height=this.height;var e=t.getContext("2d");e.beginPath(),e.lineWidth=20,e.moveTo(0,0),e.lineTo(this.width,0),e.lineTo(this.width,this.height),e.lineTo(0,this.height),e.lineTo(0,0),e.stroke();for(var n=this.productPositions,i=0;i<n.length;i++){var s=n[i];e.drawImage(this.spriteImg,s.sx,s.sy,s.w,s.h,s.dx,s.dy,s.w,s.h)}return e.font="bold 250px Ariel",e.fillStyle="black",e.textAlign="center",e.fillText(this.getIndex().toString(),this.width/2,600),t},t}();t.exports=r},function(t,e,n){"use strict";var i=this&&this.__extends||function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)},s=n(7),o=function(t){function e(){t.apply(this,arguments)}return i(e,t),e.prototype.getWidths=function(){return this.getJson("/getSegmentWidths")},e.prototype.getByPosition=function(t){return this.getJson("/getSegment?index="+t)},e}(s);t.exports=o},function(t,e){"use strict";var n="http://192.168.1.104:3000",i=function(){function t(){}return t.prototype.getJson=function(t){return new Promise(function(e,i){var s=new XMLHttpRequest;s.onload=function(t){200===s.status?e(JSON.parse(s.responseText)):i({status:s.status,message:s.responseText})},s.open("get",n+t,!0),s.send()})},t}();t.exports=i},function(t,e){function n(t){"use strict";return new Promise(function(e,n){var i=new Image;i.src=t,i.addEventListener("load",function(){e(i)}),i.addEventListener("error",function(t){n(t)})})}t.exports=n},function(t,e,n){var i=n(10),s=function(){function t(t){this.args=t,this.currentX=0;var e=t.SEGMENT_WIDTHS.length;this.loopIndex=new i(e,t.START_SEGMENT_INDEX),this.currentIndex=t.START_SEGMENT_INDEX,this.currentX=t.START_X/t.INITIAL_SCALE}return t.prototype.work=function(t){for(;this.shouldPrepend(t);)this.prepend();this.unloadUnvisibleSegments(t)},t.prototype.shouldPrepend=function(t){var e=t+this.currentX*this.args.INITIAL_SCALE;return Math.round(e+this.args.CANVAS_WIDTH)>=0},t.prototype.prepend=function(){this.currentIndex=this.loopIndex.prev();var t=this.args.SEGMENT_WIDTHS[this.currentIndex];this.currentX-=t;var e=this.args.createSegment(this.currentIndex,this.currentX);this.args.segments.push(e)},t.prototype.unloadUnvisibleSegments=function(t){for(var e=0,n=this.args.segments;e<n.length;e++){var i=n[e],s=i.getX(),o=this.getSegmentWidth(i);this.isSegmentBeforeCanvasVisibleArea(t,s,o)&&(this.currentIndex=this.loopIndex.next(),this.currentX+=o,_.pull(this.args.segments,i))}},t.prototype.isSegmentBeforeCanvasVisibleArea=function(t,e,n){var i=t+e*this.args.INITIAL_SCALE+n*this.args.INITIAL_SCALE;return Math.round(i)<=-this.args.CANVAS_WIDTH},t.prototype.getSegmentWidth=function(t){var e=this.args.SEGMENT_WIDTHS[t.getIndex()];return e},t}();t.exports=s},function(t,e){var n=function(){function t(t,e){this.itemsCount=t,this.index=e}return t.prototype.prev=function(){return this.index=this.getLastIndexIfBelowZero(this.index-1),this.index},t.prototype.next=function(){return this.index=this.getZeroIndexIfUnderLast(this.index+1),this.index},t.prototype.getZeroIndexIfUnderLast=function(t){return t===this.itemsCount?0:t},t.prototype.getLastIndexIfBelowZero=function(t){return-1===t?this.itemsCount-1:t},t}();t.exports=n},function(t,e,n){var i=n(10),s=function(){function t(t){this.args=t,this.nextIndex=0,this.nextX=0,this.segmentCount=t.SEGMENT_WIDTHS.length,this.loopIndex=new i(this.segmentCount,t.START_SEGMENT_INDEX),this.nextX=t.START_X/this.args.INITIAL_SCALE}return t.prototype.work=function(t){for(;this.shouldAppend(t);)this.append();this.unloadUnvisibleSegments(t)},t.prototype.shouldAppend=function(t){var e=-t+this.args.CANVAS_WIDTH-this.nextX*this.args.INITIAL_SCALE;return Math.round(e+this.args.CANVAS_WIDTH)>0},t.prototype.append=function(){var t=this.args.SEGMENT_WIDTHS[this.nextIndex],e=this.args.createSegment(this.nextIndex,this.nextX);this.args.segments.push(e),this.nextX+=t,this.nextIndex=this.loopIndex.next()},t.prototype.unloadUnvisibleSegments=function(t){for(var e=0,n=this.args.segments;e<n.length;e++){var i=n[e];if(this.isSegmentAfterCanvasVisibleArea(t,i.getX())){this.nextIndex=this.loopIndex.prev();var s=this.args.SEGMENT_WIDTHS[this.nextIndex];this.nextX-=s,_.pull(this.args.segments,i)}}},t.prototype.isSegmentAfterCanvasVisibleArea=function(t,e){var n=t-this.args.CANVAS_WIDTH+e*this.args.INITIAL_SCALE;return Math.round(n)>this.args.CANVAS_WIDTH},t}();t.exports=s},function(t,e){"use strict";var n=function(){function t(){this.elapsed=0,this.last=null}return Object.defineProperty(t,"instance",{get:function(){return this._instance||(this._instance=new t),this._instance},enumerable:!0,configurable:!0}),t.prototype.tick=function(t){this.elapsed=(t-(this.last||t))/1e3,this.last=t},t.prototype.get=function(){return Math.round(1/this.elapsed)},t}();t.exports=n},function(t,e){"use strict";function n(t){var e=new Hammer(t.getCanvas(),{touchAction:"none"});e.get("pan").set({direction:Hammer.DIRECTION_ALL});var n=0,i=0;return e.on("pan",function(e){t.setXMove(t.getXMove()+e.deltaX-n),n=e.deltaX,t.setYMove(t.getYMove()+e.deltaY-i),i=e.deltaY}),e.on("panend",function(t){n=0,i=0}),e.on("tap",function(e){t.onClick(e.center)}),e}t.exports=n},function(t,e){var n=function(){function t(){this.animationCount=0}return t.prototype.beginAnimation=function(){this.animationCount++},t.prototype.endAnimation=function(){this.animationCount--},t.prototype.mustRedraw=function(){return this.animationCount>0},t}();t.exports=n},function(t,e,n){var i=n(16),s=n(17),o=function(){function t(){this.animators=new Array,this.lock=new s}return t.prototype.add=function(t){this.lock.isUnlock(t.id)&&(this.lock.lock(t.id),this.animators.push(new i(t)))},t.prototype.onAnimationFrame=function(t){for(var e=0,n=this.animators;e<n.length;e++){var i=n[e];i.onAnimationFrame(t),this.removeAnimatorIfDone(i)}},t.prototype.removeAnimatorIfDone=function(t){t.isDone()&&(_.pull(this.animators,t),this.lock.unlock(t.getId()))},t}();t.exports=o},function(t,e){var n=Math.PI/2,i=function(){function t(t){this._isDone=!1,this.args=t,this.value=t.start,this.difference=t.end-t.start}return t.prototype.getId=function(){return this.args.id},t.prototype.isDone=function(){return this._isDone},t.prototype.onAnimationFrame=function(t){var e=(t-this.args.timestamp)/1e3;if(e>=1)this._isDone=!0,this.args.onChange(this.args.end);else{var i=this.args.start+Math.sin(e*n)*this.difference;this.args.onChange(i)}},t}();t.exports=i},function(t,e){var n=function(){function t(){this.dict={}}return t.prototype.lock=function(t){this.dict[t]=!0},t.prototype.unlock=function(t){delete this.dict[t]},t.prototype.isUnlock=function(t){return!this.dict[t]},t}();t.exports=n},function(t,e,n){function i(){"use strict";function t(){var t=s.instance;i.cur=t.get(),i.min=Math.min(i.min||Number.MAX_VALUE,i.cur),i.max=Math.max(i.max,i.cur),i.max&&(n.textContent="FPS: min."+i.min+" cur."+i.cur+" max."+i.max)}function e(t,e){var n=document.createElement("p");n.textContent=e||t,Modernizr[t]?n.classList.add("green"):n.classList.add("red"),o.appendChild(n)}var n=document.createElement("div");n.classList.add("debugContainer"),n.classList.add("left");var i={min:0,cur:0,max:0};setInterval(t,500);var o=document.createElement("div");o.classList.add("debugContainer"),o.classList.add("right"),e("canvas"),e("requestanimationframe","raf"),e("xhr2"),e("webworkers"),e("transferables"),e("touchevents"),e("eventlistener"),document.body.appendChild(n),document.body.appendChild(o)}var s=n(12);t.exports=i}]);